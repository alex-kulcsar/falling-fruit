/**
 * Avalanche
 * 
 * Built on
 * 
 * MakeCode Arcade blocks template v. 2.2.2
 * 
 * Template last update: 26 Aug 2020 ak
 */
// My MakeCode Arcade Game
// 
// Built on
// 
// MakeCode Arcade blocks template v. 2.2.0
// 
// Template last update: 26 Aug 2020 ak
controller.up.onEvent(ControllerButtonEvent.Pressed, function () {
    if (gameMode == 1) {
        startGame()
    } else {
    	
    }
})
controller.B.onEvent(ControllerButtonEvent.Pressed, function () {
    if (gameMode == 1) {
        startGame()
    } else {
    	
    }
})
function addBucket () {
    bucketSprite = sprites.create(bucketImages[currRow], SpriteKind.Player)
    bucketSprite.setPosition(playerSprite.x, playerSprite.y - 16 * buckets.length)
    buckets.push(bucketSprite)
}
function dropFruit () {
    fruitIndex = randint(0, fruit[currRow].length - 1)
    fruitToDrop = fruit[currRow].removeAt(fruitIndex)
    fruitToDrop.setKind(SpriteKind.Projectile)
    fruitToDrop.vy = rockSpeed
    fruitToDrop.setFlag(SpriteFlag.AutoDestroy, true)
    fruitToDrop.setFlag(SpriteFlag.Ghost, false)
}
function addLife () {
    music.powerUp.play()
    info.changeLifeBy(1)
    if (info.life() <= MAX_BUCKETS) {
        addBucket()
    }
}
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    if (gameMode == 1) {
        startGame()
    } else {
    	
    }
})
function checkForFallenFruit () {
    for (let value of sprites.allOfKind(SpriteKind.Projectile)) {
        if (value.y > scene.screenHeight()) {
            pauseLevel()
        }
    }
}
function startGame () {
    gameMode = 0
    mySplashScreen.release()
    initialize()
}
function syncBuckets () {
    for (let index = 0; index <= buckets.length - 2; index++) {
        buckets[index + 1].x = buckets[0].x
    }
}
function resumeLevel () {
    playerSpeed = START_PLAYER_SPEED
    controller.moveSprite(playerSprite, playerSpeed, 0)
    nextDrop = game.runtime() + dropInterval
    gameMode = 0
}
function clearFruit () {
    for (let value of sprites.allOfKind(SpriteKind.Projectile)) {
        value.destroy()
    }
    for (let value of sprites.allOfKind(SpriteKind.Enemy)) {
        value.destroy()
    }
}
controller.left.onEvent(ControllerButtonEvent.Pressed, function () {
    if (gameMode == 1) {
        startGame()
    } else {
    	
    }
})
function addPointsForFruit (fruit: Sprite) {
    if (fruit.width == 12) {
        info.changeScoreBy(30)
    } else if (fruit.width == 14) {
        info.changeScoreBy(20)
    } else {
        info.changeScoreBy(10)
    }
}
function showSplashScreen () {
    mySplashScreen = infoScreens.createSplashScreen()
    mySplashScreen.setTitles(["Falling", "Fruit"])
    mySplashScreen.addHeadlines(["Extra life every", "" + EXTRA_LIFE_INTERVAL + " points"])
    mySplashScreen.addHeadlines(["Inspired by", "Avalanche"])
    mySplashScreen.addHeadlines(["Avalanche is", "(C) 1978 Atari"])
    mySplashScreen.addHeadlines(["Programmed in", "MakeCode Arcade"])
    mySplashScreen.addHeadlines(["by", "Alex K."])
    mySplashScreen.addInstructionsList(["Catch the falling fruit!", "Left/Right = Move"])
    myImage = img`
        . . . . . . . . . . . 6 6 6 6 6 
        . . . . . . . . . 6 6 7 7 7 7 8 
        . . . . . . 8 8 8 7 7 8 8 6 8 8 
        . . e e e e c 6 6 8 8 . 8 7 8 . 
        . e 2 5 4 2 e c 8 . . . 6 7 8 . 
        e 2 4 2 2 2 2 2 c . . . 6 7 8 . 
        e 2 2 2 2 2 2 2 c . . . 8 6 8 . 
        e 2 e e 2 2 2 2 e e e e c 6 8 . 
        c 2 e e 2 2 2 2 e 2 5 4 2 c 8 . 
        . c 2 e e e 2 e 2 4 2 2 2 2 c . 
        . . c 2 2 2 e e 2 2 2 2 2 2 2 e 
        . . . e c c e c 2 2 2 2 2 2 2 e 
        . . . . . . . c 2 e e 2 2 e 2 c 
        . . . . . . . c e e e e e e 2 c 
        . . . . . . . . c e 2 2 2 2 c . 
        . . . . . . . . . c c c c c . . 
        `
    mySplashScreen.addMovingSprite(myImage)
    myImage = img`
        4 4 4 . . 4 4 4 4 4 . . . . . . 
        4 5 5 4 4 5 5 5 5 5 4 4 . . . . 
        b 4 5 5 1 5 1 1 1 5 5 5 4 . . . 
        . b 5 5 5 5 1 1 5 5 1 1 5 4 . . 
        . b d 5 5 5 5 5 5 5 5 1 1 5 4 . 
        b 4 5 5 5 5 5 5 5 5 5 5 1 5 4 . 
        c d 5 5 5 5 5 5 5 5 5 5 5 5 5 4 
        c d 4 5 5 5 5 5 5 5 5 5 5 1 5 4 
        c 4 5 5 5 d 5 5 5 5 5 5 5 5 5 4 
        c 4 d 5 4 5 d 5 5 5 5 5 5 5 5 4 
        . c 4 5 5 5 5 d d d 5 5 5 5 5 b 
        . c 4 d 5 4 5 d 4 4 d 5 5 5 4 c 
        . . c 4 4 d 4 4 4 4 4 d d 5 d c 
        . . . c 4 4 4 4 4 4 4 4 5 5 5 4 
        . . . . c c b 4 4 4 b b 4 5 4 4 
        . . . . . . c c c c c c b b 4 . 
        `
    mySplashScreen.addMovingSprite(myImage)
    myImage = img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . 4 4 4 4 4 4 4 4 4 4 4 4 4 4 . 
        4 4 e 4 e 4 e 4 4 e 4 e 4 e 4 4 
        . 4 4 4 4 4 4 4 4 4 4 4 4 4 4 . 
        `
    mySplashScreen.addMovingSprite(myImage)
    mySplashScreen.build()
}
function createBuckets () {
    let index = 0
    buckets = []
    currLevel = bucketImages.length - 1
    playerSprite = sprites.create(bucketImages[currRow], SpriteKind.Player)
    playerSprite.setPosition(scene.screenWidth() / 2, scene.screenHeight() - (index * 16 + 8))
    playerSprite.setStayInScreen(true)
    controller.moveSprite(playerSprite, 100, 0)
    buckets.push(playerSprite)
    for (let index = 0; index <= MAX_BUCKETS - 2; index++) {
        addBucket()
    }
    info.setLife(MAX_BUCKETS)
}
function initialize () {
    currLevel = 1
    info.setScore(0)
    START_PLAYER_SPEED = 120
    START_FRUIT_SPEED = 50
    SPEED_DELTA = 0.1
    playerSpeed = 0
    nextExtraLife = EXTRA_LIFE_INTERVAL
    DESTROY_INTERVAL = 500
    fruitImages = [[img`
        . . . . e c 7 . . . . . 
        . . . e c 7 7 e . . . . 
        . . e e c 7 e e e . . . 
        . c e e c c 2 4 2 e . . 
        c e e 2 2 2 2 5 2 2 e . 
        c e 2 2 2 2 2 4 2 2 e . 
        c e 2 2 2 2 2 2 2 2 e . 
        c e 2 2 2 2 2 2 4 2 e . 
        . 2 e 2 2 2 2 2 e e . . 
        . . 2 e 4 4 4 e . . . . 
        . . . 2 e e e e . . . . 
        . . . . . . . . . . . . 
        `, img`
        . . . . 6 . . . . . . . 
        . . . . 6 6 . . 6 8 . . 
        . . e e 8 6 6 6 7 8 . . 
        . . 2 2 e 8 6 7 6 . . . 
        . e 4 2 7 7 6 7 6 8 8 . 
        e 2 2 2 6 2 2 e 7 7 6 . 
        e 2 2 2 2 2 2 2 e c 6 . 
        e 2 2 2 2 4 2 e e c . . 
        e e 2 2 2 2 e e c . . . 
        e e 2 e 2 e e c . . . . 
        . e e e e c c . . . . . 
        . . . . . . . . . . . . 
        `, img`
        . . . . . . . 6 6 6 6 . 
        . . . 8 8 8 7 8 6 8 8 . 
        . e e c 6 6 8 . 7 8 . . 
        e 4 2 e c 8 . . 7 8 . . 
        2 2 2 2 2 e 5 4 c 8 . . 
        c 2 2 2 e 2 2 2 2 c . . 
        . c c e e 2 2 2 2 2 e . 
        . . . e c 2 e 2 e 2 c . 
        . . . . c e e e e 2 c . 
        . . . . . c 2 2 2 c . . 
        . . . . . . c c c . . . 
        . . . . . . . . . . . . 
        `], [img`
        4 4 . 4 4 4 4 . . . . . . . 
        4 5 4 5 5 5 5 4 4 . . . . . 
        b 5 1 5 1 1 5 5 5 4 . . . . 
        . 5 5 5 1 5 5 1 1 5 4 . . . 
        . d 5 5 5 5 5 5 1 1 5 4 . . 
        b 5 5 5 5 5 5 5 5 1 5 4 . . 
        c 5 5 d 5 5 5 5 5 5 5 5 4 . 
        c d 4 5 d 5 5 5 5 5 5 5 4 . 
        . 4 5 4 5 4 4 d 5 5 5 4 c . 
        . c 4 d 4 4 4 4 d d 5 d c . 
        . . 4 4 4 4 4 4 4 5 5 5 4 . 
        . . c c b 4 4 b b 4 5 4 4 . 
        . . . . c c c c c b b 4 . . 
        . . . . . . . . . . . . . . 
        `, img`
        . . . . . . 6 . . . . . . . 
        . . . . . 8 6 6 . . . 8 . . 
        . . . e e 8 8 6 6 . 6 8 . . 
        . . e 2 2 2 e 8 6 6 7 6 . . 
        . e 2 4 4 2 7 7 7 7 7 6 . . 
        . e 2 4 2 6 7 7 7 6 7 8 8 . 
        e 2 4 2 2 6 7 7 6 2 7 6 . . 
        e 2 4 2 4 2 2 2 4 2 2 7 6 . 
        e 2 4 2 2 2 2 2 2 2 2 c 6 . 
        e e 2 2 2 4 2 2 e e e c . . 
        e e e 2 e 2 2 e e e c . . . 
        e e e e e c e c c c . . . . 
        . c c c c c c . . . . . . . 
        . . . . . . . . . . . . . . 
        `, img`
        . . . . . e c 7 . . . . . . 
        . . . e e c 7 7 e e . . . . 
        . . e e e c 7 e 2 2 e . . . 
        . c e e e c 6 e e 2 2 e . . 
        . c e 2 e c c 2 4 5 2 e . . 
        c e e 2 2 2 2 2 4 5 2 2 e . 
        c e 2 2 2 2 2 2 2 2 2 2 e . 
        c e 2 2 2 2 2 2 2 2 4 2 e . 
        . e e 2 2 2 2 2 2 2 4 e . . 
        . 2 e 2 2 2 2 2 2 2 2 e . . 
        . . e 2 2 2 2 2 4 4 e . . . 
        . . 2 e e 4 4 4 2 e e . . . 
        . . . 2 2 e e e e . . . . . 
        . . . . . . . . . . . . . . 
        `], [
    img`
        . . . . . . e c 7 . . . . . . . 
        . . . . e e c 7 7 e e . . . . . 
        . . c e e e c 7 e 2 2 e e . . . 
        . c e e e e c 6 e e 2 2 2 e . . 
        . c e e e e c c 2 4 5 4 2 e . . 
        c e e e 2 2 2 2 2 4 5 5 2 2 e . 
        c e e 2 2 2 2 2 2 2 4 4 2 2 e . 
        c e e 2 2 2 2 2 2 2 2 2 2 2 e . 
        c e e 2 2 2 2 2 2 2 2 2 2 2 e . 
        c e e 2 2 2 2 2 2 2 2 2 4 2 e . 
        . e e e 2 2 2 2 2 2 2 2 4 e . . 
        . 2 e e 2 2 2 2 2 2 2 4 2 e . . 
        . . 2 e e 2 2 2 2 4 4 2 e . . . 
        . . . 2 2 e 4 4 4 2 e e . . . . 
        . . . . . 2 e e e e . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        4 4 4 . . 4 4 4 4 . . . . . . . 
        4 5 5 4 4 5 5 5 5 4 4 . . . . . 
        b 4 5 5 1 5 1 1 5 5 5 4 . . . . 
        . b 5 5 5 5 1 5 5 1 1 5 4 . . . 
        . b d 5 5 5 5 5 5 5 1 1 5 4 . . 
        b 4 5 5 5 5 5 5 5 5 5 1 5 4 . . 
        c d 5 5 5 5 5 5 5 5 5 5 5 5 4 . 
        c d 4 5 5 5 5 5 5 5 5 5 1 5 4 . 
        c 4 d 5 4 5 5 5 5 5 5 5 5 5 4 . 
        . c 4 5 5 5 d d d 5 5 5 5 5 b . 
        . c 4 d 5 4 d 4 4 d 5 5 5 4 c . 
        . . c 4 4 d 4 4 4 4 d d 5 d c . 
        . . . c 4 4 4 4 4 4 4 5 5 5 4 . 
        . . . . c c 4 4 4 b b 4 5 4 4 . 
        . . . . . . c c c c c b b 4 . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        . . . . . . . 6 . . . . . . . . 
        . . . . . . 8 6 6 . . . 6 8 . . 
        . . . e e e 8 8 6 6 . 6 7 8 . . 
        . . e 2 2 2 2 e 8 6 6 7 6 . . . 
        . e 2 2 4 4 2 7 7 7 7 7 8 6 . . 
        . e 2 4 4 2 6 7 7 7 6 7 6 8 8 . 
        e 2 4 5 2 2 6 7 7 6 2 7 7 6 . . 
        e 2 4 4 2 2 6 7 6 2 2 6 7 7 6 . 
        e 2 4 2 2 2 6 6 2 2 2 e 7 7 6 . 
        e 2 4 2 2 4 2 2 2 4 2 2 e 7 6 . 
        e 2 2 2 2 2 2 2 4 e 2 e e c 6 . 
        e e 2 e 2 2 4 2 2 e e e c . . . 
        e e e e 2 e 2 2 e e e c . . . . 
        e e e 2 e e c e c c c . . . . . 
        . c c c c c c c . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `,
    img`
        . . . . . . . . 8 8 6 6 6 6 6 . 
        . . . . . 8 8 8 7 7 8 8 6 8 8 . 
        . . e e e c 6 6 8 8 . 8 7 8 . . 
        . e 2 5 2 e c 8 . . . 6 7 8 . . 
        e 2 4 2 2 2 2 c . . . 6 7 8 . . 
        e 2 2 2 2 2 2 c . . . 8 6 8 . . 
        e 2 e 2 2 2 2 e e e e c 6 8 . . 
        c 2 e 2 2 2 2 e 2 5 4 2 c 8 . . 
        . c 2 e e 2 e 2 4 2 2 2 2 c . . 
        . . c 2 2 e e 2 2 2 2 2 2 2 e . 
        . . . c c e c 2 2 2 2 2 2 2 e . 
        . . . . . . c 2 e e 2 2 e 2 c . 
        . . . . . . c e e e e e e 2 c . 
        . . . . . . . c e 2 2 2 2 c . . 
        . . . . . . . . c c c c c . . . 
        . . . . . . . . . . . . . . . . 
        `
    ]]
    MAX_BUCKETS = 4
    bucketImages = [img`
        . . . . . . . . . . . . 
        . . . . . . . . . . . . 
        . . . . . . . . . . . . 
        . . . . . . . . . . . . 
        . . . . . . . . . . . . 
        . . . . . . . . . . . . 
        . . . . . . . . . . . . 
        . . . . . . . . . . . . 
        . . . . . . . . . . . . 
        . 4 4 4 4 4 4 4 4 4 4 . 
        4 4 e 4 e 4 4 e 4 e 4 4 
        . 4 4 4 4 4 4 4 4 4 4 . 
        `, img`
        . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . 
        . 4 4 4 4 4 4 4 4 4 4 4 4 . 
        4 4 e 4 e 4 e e 4 e 4 e 4 4 
        . 4 4 4 4 4 4 4 4 4 4 4 4 . 
        `, img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . 4 4 4 4 4 4 4 4 4 4 4 4 4 4 . 
        4 4 e 4 e 4 e 4 4 e 4 e 4 e 4 4 
        . 4 4 4 4 4 4 4 4 4 4 4 4 4 4 . 
        `]
    dropInterval = 1000
    scene.setBackgroundImage(img`
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        `)
    createBuckets()
    startLevel()
}
function updateBuckets () {
    for (let value of sprites.allOfKind(SpriteKind.Player)) {
        value.setImage(bucketImages[currRow])
    }
}
controller.right.onEvent(ControllerButtonEvent.Pressed, function () {
    if (gameMode == 1) {
        startGame()
    } else {
    	
    }
})
sprites.onOverlap(SpriteKind.Player, SpriteKind.Projectile, function (sprite, otherSprite) {
    if (gameMode == 0) {
        addPointsForFruit(otherSprite)
        otherSprite.destroy()
    }
})
function createFruit () {
    fruit = []
    fruitY = 0
    for (let value of fruitImages) {
        fruitRow = []
        fruitSprite = sprites.create(value._pickRandom(), SpriteKind.Enemy)
        fruitY += fruitSprite.height
        fruitX = Math.round(scene.screenWidth() % fruitSprite.width / 2 + fruitSprite.width / 2)
        fruitSprite.destroy()
        while (fruitX < scene.screenWidth()) {
            fruitSprite = sprites.create(value._pickRandom(), SpriteKind.Enemy)
            fruitSprite.setPosition(fruitX, fruitY)
            fruitX += fruitSprite.width
            fruitSprite.setFlag(SpriteFlag.Ghost, true)
            fruitRow.push(fruitSprite)
        }
        fruit.push(fruitRow)
    }
}
function startAttractMode () {
    gameMode = 1
    showSplashScreen()
}
function pauseLevel () {
    gameMode = 2
    controller.moveSprite(playerSprite, 0, 0)
    for (let value of sprites.allOfKind(SpriteKind.Projectile)) {
        value.vy = 0
    }
    nextDestroy = game.runtime() + DESTROY_INTERVAL
}
controller.down.onEvent(ControllerButtonEvent.Pressed, function () {
    if (gameMode == 1) {
        startGame()
    } else {
    	
    }
})
function destroyNext () {
    if (sprites.allOfKind(SpriteKind.Projectile).length > 0) {
        music.buzzer.play()
        sprites.allOfKind(SpriteKind.Projectile)[0].destroy(effects.spray, 500)
        nextDestroy = game.runtime() + DESTROY_INTERVAL
    } else {
        buckets.pop().destroy(effects.spray, 500)
        music.powerDown.playUntilDone()
        info.changeLifeBy(-1)
        if (info.life() >= MAX_BUCKETS) {
            addBucket()
            music.powerUp.playUntilDone()
        }
        if (info.life() > 0) {
            resumeLevel()
        }
    }
}
function testNextFruit () {
    if (currRow >= 0) {
        if (fruit[currRow].length > 0) {
            dropFruit()
            nextDrop = game.runtime() + dropInterval
        } else {
            currRow += -1
            if (currRow >= 0) {
                updateBuckets()
                dropFruit()
                nextDrop = game.runtime() + dropInterval
            }
        }
    } else {
        if (sprites.allOfKind(SpriteKind.Projectile).length == 0) {
            currLevel += 1
            startLevel()
        }
    }
}
// Main game update function called by `on update` loop
function updateGame () {
    syncBuckets()
    if (game.runtime() >= nextDrop) {
        testNextFruit()
    }
    if (info.score() >= nextExtraLife) {
        addLife()
        nextExtraLife += EXTRA_LIFE_INTERVAL
    }
    checkForFallenFruit()
}
function startLevel () {
    music.magicWand.play()
    clearFruit()
    rockSpeed = START_FRUIT_SPEED * (1 + SPEED_DELTA) ** (currLevel - 1)
    createFruit()
    currRow = fruit.length - 1
    updateBuckets()
    if (playerSpeed == 0) {
        playerSpeed = START_PLAYER_SPEED
    } else {
        playerSpeed = playerSpeed * (1 - SPEED_DELTA)
    }
    controller.moveSprite(playerSprite, playerSpeed, 0)
    nextDrop = game.runtime() + dropInterval
}
let nextDestroy = 0
let fruitX = 0
let fruitSprite: Sprite = null
let fruitRow: Sprite[] = []
let fruitY = 0
let fruitImages: Image[][] = []
let DESTROY_INTERVAL = 0
let nextExtraLife = 0
let SPEED_DELTA = 0
let START_FRUIT_SPEED = 0
let currLevel = 0
let myImage: Image = null
let dropInterval = 0
let nextDrop = 0
let START_PLAYER_SPEED = 0
let playerSpeed = 0
let mySplashScreen: SplashScreens = null
let MAX_BUCKETS = 0
let rockSpeed = 0
let fruitToDrop: Sprite = null
let fruit: Sprite[][] = []
let fruitIndex = 0
let buckets: Sprite[] = []
let playerSprite: Sprite = null
let currRow = 0
let bucketImages: Image[] = []
let bucketSprite: Sprite = null
let gameMode = 0
let EXTRA_LIFE_INTERVAL = 0
EXTRA_LIFE_INTERVAL = 1500
gameMode = -1
startAttractMode()
game.onUpdate(function () {
    if (gameMode == 0) {
        updateGame()
    } else if (gameMode == 2) {
        if (game.runtime() >= nextDestroy) {
            destroyNext()
        }
    } else {
        if (game.runtime() >= mySplashScreen.nextTime) {
            mySplashScreen.rotate()
        }
    }
})
